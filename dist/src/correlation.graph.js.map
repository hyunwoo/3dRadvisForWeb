{"version":3,"sources":["../../src/correlation.graph.js"],"names":["createCorrGraph","id","keys","corr","$parent","$","empty","axisMargin","parent","d3","select","eles","Array","length","svgMatrix","append","attr","gMatrix","svgAxisHori","gAxisHori","svgAxisVert","gAxisVert","dataNum","interval","e","_","forEach","k","i","p","writeText","drawLine","gx","gy","call","drag","on","gMaxX","width","gMaxY","height","event","dx","dy","Math","min","max","modX","modY","transition","d","circle","selectAll","data","enter","rColor","rgb","bColor","y","x","c","rc","drawRect","abs","__CorrNetwork","CreateCorrNetwork","comp","appendTo","container","document","getElementById","replace","nodes","vis","DataSet","map","label","color","size","isNil","console","log","destroy","edges","options","shape","Network","savedIdx","idx","setEdge","mode","rawEdges","remove","val","takeRight","cut_cor","Number","startsWith","cs","maxVal","maxIndex","minVal","minIndex","update","from","to","arrows","params","node","_data"],"mappings":"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","file":"correlation.graph.js","sourcesContent":["function createCorrGraph(id, keys, corr) {\r\n    // 1. 그래프 그리기\r\n    // 아이디의 속성 값을 정해줄 클래스를 붙여준다\r\n\r\n    return;\r\n\r\n    var $parent = $(id);\r\n    $parent.empty();\r\n    var axisMargin = 100;\r\n    var parent = d3.select(id);\r\n\r\n    let eles = new Array(keys.length);\r\n    const svgMatrix = parent.append('svg').attr('class', 'field');\r\n    const gMatrix = svgMatrix.append('g');\r\n\r\n    const svgAxisHori = parent.append('svg').attr('class', 'axis horizon')\r\n    const gAxisHori = svgAxisHori.append('g');\r\n\r\n    const svgAxisVert = parent.append('svg').attr('class', 'axis vertical')\r\n    const gAxisVert = svgAxisVert.append('g');\r\n\r\n    var dataNum = keys.length;\r\n\r\n    var interval = 25;\r\n\r\n    var e = interval * dataNum;\r\n\r\n    _.forEach(keys, function (k, i) {\r\n        var p = interval * i;\r\n        writeText(gAxisHori, k, p + interval / 2, axisMargin - 20, -90, 'axis');\r\n        writeText(gAxisVert, k, axisMargin - 20, p + interval / 2, 0, 'axis')\r\n            .attr('text-anchor', 'end');\r\n        drawLine(gMatrix, 0, p, e, p).attr('class', 'line');\r\n        drawLine(gMatrix, p, 0, p, e).attr('class', 'line');\r\n    });\r\n\r\n\r\n    var gx = 0;\r\n    var gy = 0;\r\n\r\n    svgMatrix.call(d3.drag().on('drag', () => {\r\n\r\n        var gMaxX = interval * dataNum - $(id).width() + axisMargin;\r\n        var gMaxY = interval * dataNum - $(id).height() + axisMargin;\r\n\r\n        gx -= d3.event.dx * 1;\r\n        gy -= d3.event.dy * 1;\r\n\r\n        gx = Math.min(gMaxX, Math.max(0, gx));\r\n        gy = Math.min(gMaxY, Math.max(0, gy));\r\n\r\n        gMatrix.attr('transform', `translate(${-gx},${-gy})`);\r\n        gAxisHori.attr('transform', `translate(${-gx},0)`);\r\n        gAxisVert.attr('transform', `translate(0,${-gy})`);\r\n\r\n    }).on('end', () => {\r\n        var modX = gx % interval;\r\n        var modY = gy % interval;\r\n        gx -= modX < interval / 2 ? modX : -(interval - modX);\r\n        gy -= modY < interval / 2 ? modY : -(interval - modY);\r\n\r\n        gMatrix.transition().attr('transform', `translate(${-gx},${-gy})`);\r\n        gAxisHori.transition().attr('transform', `translate(${-gx},0)`);\r\n        gAxisVert.transition().attr('transform', `translate(0,${-gy})`);\r\n    }));\r\n\r\n    var d = [12, 3];\r\n\r\n    var circle = gMatrix.selectAll('circle').data(corr);\r\n    circle.enter().append('circle');\r\n\r\n    var rColor = d3.rgb(151, 15, 38);\r\n    var bColor = d3.rgb(5, 48, 97);\r\n\r\n    _.forEach(corr, function (d, y) {\r\n        _.forEach(d, function (d, x) {\r\n            // var c = d > 0 ? bColor.brighter((1 - d) * cWeight) : rColor.brighter((1 + d) * cWeight);\r\n            // var rc = drawRect(gMatrix, x * interval + interval / 2, y * interval + interval / 2, Math.abs(d) * interval / 2).attr('fill', c);\r\n            var c = d > 0 ? bColor : rColor;\r\n            var rc = drawRect(gMatrix, x * interval + 1, y * interval + 1, interval - 2).attr('fill', c)\r\n                .attr('opacity', Math.min(Math.abs(d) * 1.3, 1));\r\n\r\n        });\r\n    });\r\n\r\n}\r\n\r\n\r\nlet __CorrNetwork;\r\nfunction CreateCorrNetwork(id, keys, corr) {\r\n    $(id).empty();\r\n    let comp = $('<div class=\"absolute\"></div>').appendTo(id);\r\n\r\n    var container = document.getElementById(id.replace('#', ''));\r\n\r\n    var nodes = new vis.DataSet(_.map(keys, (d, i) => {\r\n        return {id: i, label: d, color: '#0188E5', size: 20, select: true}\r\n    }));\r\n\r\n    if (!_.isNil(__CorrNetwork)) {\r\n        console.log(__CorrNetwork);\r\n        __CorrNetwork.destroy();\r\n        __CorrNetwork = null;\r\n    }\r\n    // create an array with edges\r\n    var edges = new vis.DataSet([]);\r\n    var data = {\r\n        nodes: nodes,\r\n        edges: edges\r\n    };\r\n    var options = {\r\n        nodes: {\r\n            shape: 'dot',\r\n            size: 10\r\n        },\r\n        \"edges\": {\r\n            \"smooth\": {\r\n                \"forceDirection\": \"none\"\r\n            }\r\n        },\r\n        \"physics\": {\r\n            \"maxVelocity\": 4,\r\n            \"minVelocity\": 0.07\r\n        }\r\n    };\r\n    __CorrNetwork = new vis.Network(container, data, options);\r\n\r\n    var savedIdx = 0;\r\n    var idx = 0;\r\n    this.setEdge = function (mode) {\r\n        if (_.isNil(mode)) mode = 'Most Impact (ABS Correlation more that 0.7)';\r\n        var rawEdges = [];\r\n\r\n        for (var i = 0; i < idx; i++) edges.remove({id: i});\r\n\r\n        console.log(edges);\r\n        idx = 0;\r\n\r\n        var val = _.takeRight(mode, 5);\r\n        var cut_cor = (val[0] == '-' ? -.1 : .1 ) * Number(val[3]);\r\n        if (mode.startsWith('Most Impact')) {\r\n            _.forEach(corr, (cs, x) => {\r\n                var maxVal = 0;\r\n                var maxIndex = -1;\r\n                var minVal = 0;\r\n                var minIndex = -1;\r\n                _.forEach(cs, (c, y) => {\r\n                    if (x < y) {\r\n                        if (c < -cut_cor) {\r\n                            minVal = c;\r\n                            minIndex = y;\r\n                        } else if (c > cut_cor) {\r\n                            maxVal = c;\r\n                            maxIndex = y;\r\n                        }\r\n                    }\r\n                });\r\n\r\n                if (maxIndex != -1) edges.update({id: ++idx, from: x, to: maxIndex, color: '#0188E5', arrows: 'to'});\r\n                if (minIndex != -1) edges.update({id: ++idx, from: x, to: minIndex, color: '#ff5e7C', arrows: 'to'});\r\n            });\r\n        } else {\r\n            _.forEach(corr, (cs, x) => _.forEach(cs, (c, y) => {\r\n                if (x < y && Math.abs(c) > cut_cor) {\r\n                    edges.update({id: ++idx, from: x, to: y, color: c < 0 ? '#ff5e7C' : '#0188E5'});\r\n                }\r\n            }));\r\n        }\r\n\r\n\r\n        for (var i = idx; i < savedIdx; i++) edges.remove({id: i});\r\n        savedIdx = idx;\r\n    };\r\n\r\n    __CorrNetwork.on(\"stabilized\", function (params) {\r\n        // network.physics.physicsEnabled = false;\r\n    });\r\n\r\n\r\n    __CorrNetwork.on(\"selectNode\", function (params) {\r\n        var node = nodes._data[params.nodes[0]];\r\n        node.select = !node.select;\r\n        if (node.select) {\r\n            node.size = 20;\r\n            node.color = '#0188E5';\r\n        }\r\n        else {\r\n            node.size = 20;\r\n            node.color = '#cccccc';\r\n        }\r\n        nodes.update(node);\r\n    });\r\n\r\n    this.setEdge();\r\n\r\n}"]}