{"version":3,"sources":["../../src/firebase.wrapper.js"],"names":["config","apiKey","authDomain","databaseURL","storageBucket","messagingSenderId","__Firebase","fb","firebase","initializeApp","auth","user","undefined","isSetReferences","EventName","ChildAdded","ChildRemoved","ChildChange","that","authChange","addAuthChangeFunction","evt","push","storage","testDataUrl","providerGoogle","GoogleAuthProvider","onAuthStateChanged","console","log","$","html","displayName","initDBReferences","_","forEach","d","DBRefDataList","callbackEvents","database","ref","uid","events","on","snapshot","val","callback","isNil","unbind","error","remove","clearDBReferences","getDataList","signInWithGoogle","signInWithPopup","then","result","token","credential","accessToken","catch","errorCode","code","errorMessage","message","email","signInWithEmail","signOut","__UIStatic","Toast","open","window","location","getDataContent","key","deleteData","_id","set","uploadData","f","refList","refRaw","updates","name","size","type","lastModified","overview","contents","update"],"mappings":"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","file":"firebase.wrapper.js","sourcesContent":["/**\r\n * Created by hyunwoo on 2017-02-16.\r\n */\r\nvar config = {\r\n    apiKey: \"AIzaSyBmWUxSYfDdIig4b_Nk_8zGW5VdDr1qY-M\",\r\n    authDomain: \"dradvis.firebaseapp.com\",\r\n    databaseURL: \"https://dradvis.firebaseio.com\",\r\n    storageBucket: \"dradvis.appspot.com\",\r\n    messagingSenderId: \"20687471588\"\r\n};\r\n\r\nlet __Firebase = new function () {\r\n    let fb = firebase.initializeApp(config);\r\n    let auth = fb.auth();\r\n    this.user = undefined;\r\n    let isSetReferences = false;\r\n\r\n\r\n    this.EventName = {\r\n        ChildAdded: 'child_added',\r\n        ChildRemoved: 'child_removed',\r\n        ChildChange: 'child_changed'\r\n    }\r\n    const that = this;\r\n    this.authChange = [];\r\n\r\n    this.addAuthChangeFunction = function (evt) {\r\n        that.authChange.push(evt);\r\n    };\r\n\r\n    this.storage = firebase.storage();\r\n    this.testDataUrl = 'https://firebasestorage.googleapis.com/v0/b/dradvis.appspot.com/o/credos_testing.csv?alt=media&token=27152d59-bf4a-41cf-8658-1c3581c08c5e';\r\n    let providerGoogle = new firebase.auth.GoogleAuthProvider();\r\n\r\n    fb.auth().onAuthStateChanged(function (user) {\r\n        that.user = user;\r\n        if (user) {\r\n            console.log('auth changed');\r\n            console.log(user);\r\n            $('.userName').html(user.displayName);\r\n            initDBReferences();\r\n            isSetReferences = true;\r\n        } else {\r\n        }\r\n        _.forEach(that.authChange, function (d) {\r\n            d(user);\r\n        });\r\n        // __UIStatic.onAuthChange(user);\r\n    });\r\n\r\n\r\n    let DBRefDataList;\r\n    let callbackEvents = {};\r\n\r\n\r\n    function initDBReferences() {\r\n        if (isSetReferences) return;\r\n        isSetReferences = true;\r\n\r\n        DBRefDataList = fb.database().ref(that.user.uid + '/list');\r\n        var events = ['child_added', 'child_changed', 'child_removed'];\r\n        _.forEach(events, function (evt) {\r\n            DBRefDataList.on(evt, function (snapshot) {\r\n                console.log(evt, snapshot.val())\r\n                _.forEach(callbackEvents[evt], function (callback) {\r\n                    callback(snapshot.val());\r\n                })\r\n            });\r\n        });\r\n\r\n    }\r\n\r\n    this.on = function (evt, callback) {\r\n        if (_.isNil(callbackEvents[evt])) callbackEvents[evt] = [];\r\n        callbackEvents[evt].push(callback);\r\n        return callback;\r\n    };\r\n\r\n    this.unbind = function (evt, callback) {\r\n        if (_.isNil(callbackEvents[evt])) {\r\n            console.error('event not binded');\r\n            return;\r\n        }\r\n        if (_.isNil(callback)) callbackEvents[evt] = [];\r\n        else if (!_.isNil(callback)) callbackEvents[evt] = _.remove(callbackEvents[evt], callback);\r\n    };\r\n\r\n\r\n    function clearDBReferences() {\r\n\r\n    }\r\n\r\n    this.getDataList = function () {\r\n\r\n    };\r\n\r\n    this.signInWithGoogle = function () {\r\n        console.log('?');\r\n        fb.auth().signInWithPopup(providerGoogle).then(function (result) {\r\n            var token = result.credential.accessToken;\r\n            var user = result.user;\r\n            console.log('??');\r\n            // ...\r\n        }).catch(function (error) {\r\n            console.log(error);\r\n            // Handle Errors here.\r\n            var errorCode = error.code;\r\n            var errorMessage = error.message;\r\n            // The email of the user's account used.\r\n            var email = error.email;\r\n            // The firebase.auth.AuthCredential type that was used.\r\n            var credential = error.credential;\r\n            // ...\r\n        });\r\n    };\r\n\r\n    this.signInWithEmail = function () {\r\n\r\n    };\r\n\r\n    this.signOut = function () {\r\n        if (_.isNil(that.user)) {\r\n            __UIStatic.Toast.open(\"Auth Failed\");\r\n            return;\r\n        }\r\n\r\n        auth.signOut().then(function () {\r\n            that.user = undefined;\r\n            window.location = '/';\r\n        }, function (error) {\r\n            __UIStatic.Toast.open(\"SignOut Failed\");\r\n        });\r\n\r\n    };\r\n\r\n    this.getDataList = function () {\r\n        if (_.isNil(that.user)) {\r\n            __UIStatic.Toast.open(\"Auth Failed\");\r\n            return;\r\n        }\r\n    };\r\n\r\n    this.getDataContent = function (key) {\r\n        if (_.isNil(that.user)) {\r\n            __UIStatic.Toast.open(\"Auth Failed\");\r\n            return;\r\n        }\r\n    };\r\n\r\n    this.deleteData = function (d) {\r\n        console.log('deleteData:', d);\r\n        var ref = fb.database().ref(that.user.uid + '/list/' + d._id);\r\n        ref.set(null);\r\n    };\r\n\r\n\r\n    this.uploadData = function (f) {\r\n        console.log('uploadFile!?');\r\n        if (_.isNil(that.user)) {\r\n            __UIStatic.Toast.open(\"Auth Failed\");\r\n            return;\r\n        }\r\n        const refList = fb.database().ref(that.user.uid + '/list');\r\n        const refRaw = fb.database().ref(that.user.uid + '/raw');\r\n        const key = refList.push().key;\r\n\r\n        console.log(f);\r\n        var updates = {};\r\n        console.log(that.user.uid + '/list/' + key);\r\n        updates[that.user.uid + '/list/' + key] = {\r\n            name: f.name,\r\n            size: f.size,\r\n            type: f.type,\r\n            lastModified: f.lastModified,\r\n            _id: key,\r\n            overview: 'Not Yet Set Overview',\r\n        };\r\n\r\n        updates[that.user.uid + '/raw/' + key] = f.contents;\r\n        fb.database().ref().update(updates);\r\n    };\r\n};\r\n\r\n$(function () {\r\n    __Firebase.getDataList()\r\n});\r\n\r\n\r\n\r\n\r\n"]}